name: Monitor MOE Files via Telegram

on:
  # يعمل كل ساعة (في الدقيقة صفر من كل ساعة)
  schedule:
    - cron: '0 * * * *' 
  # يسمح بالتشغيل اليدوي من واجهة GitHub
  workflow_dispatch: 

jobs:
  run_scraper:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' 
          
      - name: Install dependencies
        # تثبيت المكتبات من requirements.txt
        run: pip install -r requirements.txt
        
      - name: Run Scraper Script
        # تشغيل البوت وتمرير مفاتيح Telegram السرية كمتغيرات بيئة
        run: python monitor.py
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        
      - name: Commit history file
        # الأهم: حفظ ملف السجل (moe_files_history.txt) مرة أخرى إلى المستودع
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Automatic update: Update file history after scraping."
          files: moe_files_history.txt 
